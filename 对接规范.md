
## 1. 概述
文本规定了应用程序的接口开发规范，用于指导公司内部及对外的应用接口开发。
### 1.1. 使用范围
-  1.公司内部应用之间的数据调用
-  2.前端页面与后端服务的数据调用
-  3.公司对外的所有数据接口
## 2. 规范描述
### 2.1. 协议规范
- API使用**http(s)**作为通信协议。
### 2.2. 编码规范
- 接口的请求参数及返回数据统一采用**UTF-8**编码。
### 2.3. 接口地址规范
API接口地址设计应当遵循以下约定：
-  1.公司通用接口（如短信发送接口）应当通过名为api的二级域名访问，例如**http://api.电无忧-info.com** 。
-  2.应用接口应当通过形如**http://program-name.电无忧.com/api**的基本地址访问。
-  3.接口地址中应当全部为小写字母，且尽量使用单个单个作为目录名称，如果目录名称为多个单词，则应以下划线连接，例如：**/api/law/item**或 **/api/**server_provider 
### 2.4. 请求方式规范
-  Http(s)接口请求支持以下方式：
-  1.GET
-  2.POST
-  3.PUT
-  4.DELETE
同一接口同时只能支持一种请求方式（即接口请求方式为GET时，POST方式的请求要么是无效的请求，要么是功能不同的另一个接口）
获取（查询）数据应当使用GET请求方式，如请求参数较为复杂（必须使用JSON格式表达参数），则可以使用POST请求方式。
新增数据使用POST请求方式
修改数据使用PUT请求方式。
删除数据使用DELETE请求方式。
#### 2.4.1 POST请求数据提交方式 content-type  属性设置
当入参数据中包含 嵌套类型参数，数组类型参数，对象类型参数，使用 **application/json** 属性；否则，使用 **multipart/form-data** 属性
### 2.5. 设计原则
#### 1.接口设计优先采用RESTful风格， 在对单个资源进行增删改查时，分别使用以下方式请求：

操作类型 |	接口地址 |	请求方式
---|---|---
增加 |	/api/resource	| POST
删除 |  /api/resource/{id} |	DELETE
修改 |  /api/resource/{id} |	PUT
查找 |	/api/resource/{id} |  GET
- 1.同一应用中，接口的所有风格必须保持一致，例如参数名称，如果为下划线连接多个单词的命名方式，则所有接口的参数命名均采用该方式。若参数名称为驼峰命名时，则所有接口的参数也全部使用驼峰命名方式。
- 2.同一应用中，接口的所有风格必须保持一致，入参及出参采用小驼峰命名方式。
### 2.6. 数据规范
#### 2.6.1.   参数规范
接口参数的传递分为4种：
- 1.路径参数：直接携带在请求路径中，路径参数的命名规范参见接口地址规范
- 2.地址栏参数：作为URL的一部分，以**?param1=value1&param2=value2**的形式接在URL后面传递。该类参数的命名格式可以为下划线连接小写单词或小驼峰命名，但在同一应用中必须保持一致。
- 3.表单型参数：请求头中设置**Content-Type**为**application/x-www-form-urlencoded**，请求的**body**为**param1=value1&param2=value2**, 该类参数的命名格式应和地址栏参数命名格式保持一致
- 4.JSON格式参数：请求头中设置**Content-Type**为**text/plain**或**application/json**，JSON格式的参数中，字段名应与地址栏参数的命名格式保持一致。
- 5.路径参数只能位于路径的最后，且必须为资源的唯一标识。
- 6.如果存在多级资源的情况下，url上的路径参数只能是最后一级资源的唯一标识，且路径参数必须位于路径的最后，其他级别的资源的标识如果作为参数统一放在请求参数中，不允许放入路径
- 7.入参参数避免null字符串；

#### 2.6.2.   状态码规范
只要api接口成功接收到请求，状态码就必须返回**200**，如果请求无法响应正确的结果，请求的错误类型应当使用返回数据中的code进行体现，并使用msg加以描述。

接口请求的逻辑被正确处理时，返回code为0
接口请求逻辑出现错误时，返回的code应不等于0
code应为0~99之间的正整数。

#### 2.6.3.   结果描述规范
接口请求的逻辑被正确处理时，不需要对结果进行描述，返回的结果当中msg应当为空
接口请求逻辑出现错误时，使用返回值中的msg对错误进行描述

#### 2.6.4.   响应数据规范
响应的数据格式统一为JSON格式，响应头中的Content-Type应该设为application/json;charset=utf8。
请求返回的JSON数据必须符合以下结构：

分页形式：
```
{
    "code": 0,
  	"msg": "",
    "data": {
      "pager":{
        "page": 1,
        "pageSize": 10,
        "total": 10
      },
      "list":[]
    }
}
```
非 分页形式：
```
{
  "code": 0,
  "data": {}|[],
  "msg": ""
}
```
各字段含义如下：
- 1.code: 状态码，0表示请求成功，其他表示请求失败
- 2.data: 请求返回的数据，可以是对象也可以是数组
- 3.msg: 对状态的描述，code为0时可以为空，code不为0时必须对code进行描述
### 2.7. 版本管理规范
如果同一接口有多个版本存在，应当在请求路径中体现，以v+版本号（整数）的形式添加在/api后面，如
```
/api/v2/user/detail
```
### 2.8. 部署环境搭建
前端、接口应同步环境开发及部署，根据项目及开发需求，现需搭建 本地开发、测试、生产 环境：
- 本地开发：开发阶段、联调、本次测试阶段
- 测试：测试阶段
- 生产：发布线上
接口跨域问题，统一由前端项目协调运维部署Nginx代理。按照前端/运维项目跨域字段填写
### 2.9. 其它规范
- 1.列表分页初始页面数值从 **1** 开始；
- 2.资源类（图片/文件）路径字段提供完整路径信息，域名 + 资源路径；
- 3.出参、入参时间/日期类型统一返回时间戳（13位）；如需特殊处理，前后端具体对接；
- 4.参数避免使用大数值类型（Long），因为前端处理不了过长精度，最大精确到小数点后4位；
- 5.列表数据中，如果有id标识，需给出map形式，包含{ id: value };
## 3. 接口安全性
接口应当使用https进行部署。

### 3.1. 权限验证
接口权限验证分为两个步骤：
- 1.接口提供方应提供app-id和app-secret用于接口权限验证，app-id与应用绑定，每个应用对应一个app-id，且生成之后不可变。app-secret与应用绑定，每个应用对应一个app-secret，但app-secret可以变更，如app-id和app-secret泄露时，应及时变更app-secret，保证接口安全。
- 2.接口提供方对app-id和app-secret进行验证，验证通过后返回access-token作为后续接口访问的凭证,access-token必须设置有效期，且同access-token一同返回给接口调用方。有效期过后，接口调用方应使用app-id和app-secret重新获取access-token。
Access-token使用规范：
   Access-token使用时应使用名称为Authorization的请求头传递
Access-token生成原则：
服务端生成的access-token一般为随机的非重复字符串，根据应用对安全性的不同要求，会将其添加时间戳（通过时间判断access-token是否被盗用）或url签名（通过请求地址判 断Token是否被盗用）后加密进行传输。一般Token内容包含有：用户名/appid，密码/appsecret, 授权url，用户自定义token(用户自定义签名)，时间戳，有效期时长(秒), 系统签名(sign)等。
 

